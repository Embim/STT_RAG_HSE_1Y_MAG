# STT_RAG_HSE_1Y_MAG
Audio2RAG (DS Navigator)
# Audio2RAG (DS Navigator)

> **Коротко:** офлайн‑инжест лекций/докладов (YouTube, конференции, подкасты) → качественная транскрибация с диаризацией и шумоподавлением → умная пост‑обработка (суммаризация, топики, ключи, Q&A) → разметка по таймкодам → индексирование в векторной БД → **RAG‑поиск** с ответами LLM + **кликабельные ссылки на источники и таймкоды** в ответах.

> **Ценность:** не «ещё один сервис транскрибации», а **навигатор знаний по DS‑домену** с доказательными ответами и маршрутизацией к первоисточнику.

---

## Содержание

* [Идея и ценность](#идея-и-ценность)
* [Ключевые сценарии пользователя](#ключевые-сценарии-пользователя)
* [Фичи](#фичи)
* [Архитектура](#архитектура)
* [Пайплайн обработки данных](#пайплайн-обработки-данных)
* [Модели и стек](#модели-и-стек)
* [Качество, метрики и валидирование](#качество-метрики-и-валидирование)
* [Экономика и SLA](#экономика-и-sla)
* [Безопасность, право и приватность](#безопасность-право-и-приватность)
* [API и интеграции](#api-и-интеграции)
* [Запуск локально и в Docker](#запуск-локально-и-в-docker)
* [Схема БД](#схема-бд)
* [Roadmap](#roadmap)
* [Неголы (out of scope v1)](#неголы-out-of-scope-v1)
* [Лицензия](#лицензия)

---

## Идея и ценность

Изначально ТЗ подразумевало «сервис транскрибации»: диаризация спикеров, борьба с шумами, базовая суммаризация/топики. Это полезно, но **слабая продуктовая дифференциация**.

**PIVOT:** делаем ставку на **RAG поверх аудио/видео‑контента**. Мы офлайн‑собираем лекции/доклады (RU/EN) из DS‑домена, аккуратно транскрибируем, **сохраняем не «голые тексты», а структурированные сегменты** с таймкодами, спикерами и метаданными. Запрос пользователя (пока через Telegram‑бот) обрабатывается как **семантический поиск + компоновка ответа LLM** с цитатами и кликабельными таймкодами к первоисточнику.

**Пользовательская ценность:**

* Быстро найти **релевантные куски** длинных лекций.
* Получить **конспект/пояснение** и **ссылки на точные моменты**.
* Научиться быстрее: план изучения, краткие справки, **quiz/survey по теме**.

---

## Ключевые сценарии пользователя

1. **Вопрос по теме**: «Как дообучать маленькие embedding‑модели?» → ответ LLM + 3–5 источников с таймкодами, краткими описаниями, цитатами.
2. **Обзор/конспект**: «Дай краткий обзор Retrieval‑Augmented Generation» → авто‑конспект, список ключевых понятий, ссылки на видео‑фрагменты.
3. **Учебный маршрут**: «Хочу за выходные разобраться с contrastive learning» → персональный роадмап c плейлистом, таймкодами, контрольными вопросами и **quiz**.
4. **Интервью‑разбор (опционально)**: загрузка своего видео/аудио интервью → метрики участия спикеров, время речи, перебивания, **оценка уверенности по просодике**, качество звука; при наличии видео — **глазной контакт/внимание** (см. «A/V‑аналитика» ниже).

---

## Фичи

### Core v1

* **Ингест источников**: YouTube (yt‑dlp), сайты конференций/подкастов, RSS. Метаданные: язык, спикер(ы), теги, лицензия.
* **STT высокого качества**: VAD → шумоподавление → транскрибация → диаризация → выравнивание по времени. Multi‑lingual RU/EN.
* **Пост‑обработка**: абзацирование, пунктуация, именованные сущности, **суммаризация**, **топики**, **keyphrases**, генерация Q&A.
* **Сегментация**: таймкодные «кусочки» (30–90 сек) с полями: speaker(s), тема, ключи, цитаты.
* **Индексирование**: мультиязычные эмбеддинги + метаполя в **векторной БД** (гибрид: BM25 + dense + rerank).
* **RAG‑ответы**: LLM строит ответ с **цитатами, ссылками и таймкодами**, указывает уверенность.
* **Telegram‑бот**: /ask, /sources, /plan, /quiz. Поддержка markdown и превью ссылок с `t=`.

### Plus v1.1–v1.2

* **Перевод** RU↔EN (для кросс‑языковых запросов).
* **Query‑routing** (dense/sparse mix), **context compression** (rank‑fusion), reranker.
* **LLM‑Survey/Quiz**: автогенерация опросов, тестов, карточек (spaced repetition) по выбранной теме/видео.

### A/V‑аналитика (опционально, v2)

* **Подсчёт спикеров/присутствующих** (диаризация аудио + face‑tracking на видео).
* **Вовлечённость в интервью**: доля речи, частота перебиваний, средняя пауза до ответа, скорость/питч/вариативность, **оценка уверенности по просодике**.
* **Глазной контакт**: gaze‑tracking (если есть видео), доля времени «в камеру».
* **Качество звука**: SNR, клик/эхо, громкость, рекомендация по улучшению.

---

## Архитектура

```mermaid
flowchart LR
  U[Пользователь (TG-бот)] -->|/ask| API
  subgraph Online
    API[FastAPI Gateway]
    RETR[Retriever (BM25 + VDB + Rerank)]
    LLM[LLM Answerer]
  end

  subgraph Offline Ingest & Index
    SCHED[Scheduler]
    QUEUE[(Redis/RabbitMQ)]
    W1[Worker: Fetch & Store]
    W2[Worker: STT + Diarization + Denoise]
    W3[Worker: Postprocess (Summ/Topics/Q&A)]
    W4[Worker: Chunk+Embed]
    VDB[(Vector DB)]
    MDB[(Postgres Metadata)]
    BLOB[(S3/MinIO)]
  end

  API --> RETR --> VDB
  RETR --> LLM --> API

  SCHED --> QUEUE
  QUEUE --> W1 --> BLOB & MDB
  W1 --> W2 --> BLOB & MDB
  W2 --> W3 --> MDB
  W3 --> W4 --> VDB & MDB
```

**Масштабирование:** воркеры горизонтально, автоскейл по длине очереди; API — stateless; БД с репликами; VDB с шардингом.

---

## Пайплайн обработки данных

1. **Загрузка**: `yt-dlp` → аудио/видео в `BLOB`, метаданные в `MDB`.
2. **Аудио препроцессинг**: VAD (Silero), шумоподавление (RNNoise/Demucs), нормализация громкости.
3. **STT**: Whisper‑семейство или аналог (см. ниже). Получаем слова/фразы с таймкодами.
4. **Диаризация**: pyannote.audio → speaker turns; маппинг к текстовым сегментам.
5. **Вырав
